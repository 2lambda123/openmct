version: '3.8'
services:
  # moved to ./browserless.dockercompose.yaml
  # browserless:
   
  mon_prometheus:
    image: prom/prometheus:latest
    container_name: prometheus
    command: --config.file=/etc/prometheus/prometheus.yml
    volumes:
      - /etc/localtime:/etc/localtime:ro
      - /etc/timezone:/etc/timezone:ro
      - ${PWD}/prometheus.yml:/etc/prometheus/prometheus.yml
      - prometheus_data:/prometheus
    restart: always
    ports:
      - "9090:9090"
    expose:
      - 9090
    networks:
      - perf_monitoring
    extra_hosts:
      - "host.docker.internal:host-gateway"
  mon_grafana:
     image: grafana/grafana:latest
     container_name: mon_grafana
     restart: unless-stopped
     volumes:
       - /etc/localtime:/etc/localtime:ro
       - /etc/timezone:/etc/timezone:ro
       - grafana_data:/var/lib/grafana
       - ${PWD}/grafana/datasources:/etc/grafana/datasources
       - ${PWD}/grafana/dashboards:/etc/grafana/dashboards
       - ${PWD}/grafana/config/grafana.ini:/etc/grafana/grafana.ini
     env_file: 
       - ./env.compose
     ports:
       - 3006:3000
     expose:
       - 3006
       - 3000
     networks:
      - perf_monitoring
  mon_influxdb:
    image: influxdb:latest
    container_name: influxdb
    ports:
      - "8086:8086"
    volumes:
      - influxdb_data:/var/lib/influxdb
    env_file: 
      - ./env.compose
    expose:
      - 8086
    networks:
      - perf_monitoring
networks:
  perf_monitoring:
    driver: bridge

volumes:
  grafana_data: {}
  prometheus_data: {}
  influxdb_data: {}
